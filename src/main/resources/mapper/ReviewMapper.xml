<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.acorn.chapspring.mapper.ReviewMapper">
    <resultMap id="ReviewMap" type="com.acorn.chapspring.dto.ReviewsDto">
        <id column="review_num" property="reviewNum"/>
        <result column="content" property="content"/>
        <result column="comment" property="comment"/>
        <result column="img" property="img"/>
        <result column="date" property="date"/>
        <result column="star" property="star"/>
        <result column="r_rstatus" property="rrStatus"/>
        <result column="user_id" property="userId"/>
        <result column="store_num" property="storeNum"/>
        <result column="menu_num" property="menuNum"/>
        <collection property="userInfo"
                     select="com.acorn.chapspring.mapper.UserMapper.findByUserId"
                     column="user_id"
                     fetchType="eager"/>
        <collection property="countReview"
                    select="com.acorn.chapspring.mapper.UserMapper.countReviewByUser"
                    column="user_id"
                    fetchType="eager"/>
        <collection property="rReplies"
                    select="com.acorn.chapspring.mapper.ReviewRepliesMapper.findByReview"
                    column="review_num"
                    fetchType="eager"/>
    </resultMap>


    <select id="findReviewByStore" resultMap="ReviewMap">
        SELECT * FROM reviews WHERE store_num=#{storeNum};
    </select>

<!--    리뷰작성 리스트 출력용-->
    <select id="findAllReviewed" resultMap="ReviewMap">
        select * from reviews where user_id=#{userId};
    </select>
    <!-- 가게별 리뷰수 -->
    <select id="countReviewByStore" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM reviews WHERE store_num=#{storeNum};
    </select>
</mapper>